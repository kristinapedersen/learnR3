---
title: "Draft R Markdown document"
author: "Your Name"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(vroom)
library(here)
library(fs)
library(tidyverse)
source(here("R/functions.R")) #runs all the functions I have make at once
```

## Importing raw data

```{r}
user_1_info_file <- here("data-raw/mmash/user_1/user_info.csv")
user_1_info_data <- vroom(user_1_info_file)
```

```{r}
user_1_info_data <- vroom(
    user_1_info_file,
    col_select = -1,
    col_types = cols(
        gender = col_character(),
        weight = col_double(),
        height = col_double(),
        age = col_double()
    ),
    .name_repair = snakecase::to_snake_case
)
user_1_info_data
```

## Exercise: Import the saliva data

```{r}
user_1_saliva_file <- here("data-raw/mmash/user_1/saliva.csv")
user_1_saliva_data_prep <- vroom(
    user_1_saliva_file,
    col_select = -1,
    .name_repair = snakecase::to_snake_case
)
spec(user_1_saliva_data_prep)

user_1_saliva_data <- vroom(
    user_1_saliva_file,
    col_select =  -1,
    col_types = cols(
        col_skip(),
        samples = col_character(),
        cortisol_norm = col_double(),
        melatonin_norm = col_double()
    ),
    
    .name_repair = snakecase::to_snake_case
)
user_1_saliva_data_prep
```

## Import larger datasets

```{r}
user_1_rr_file <- 
    here("data-raw/mmash/user_1/RR.csv")
user_1_rr_data_prep <- vroom(
    user_1_rr_file,
    col_select = -1,
    n_max = 100,
    .name_repair = snakecase::to_snake_case
)
spec(user_1_rr_data_prep)

user_1_rr_data <- vroom(
    user_1_rr_file,
    col_select = -1,
    col_types = cols(
        ibi_s = col_double(),
        day = col_double(),
        time = col_time(format = "")  #if time format are giving problems this will help
    ),
    
    .name_repair = snakecase::to_snake_case
)
```

## Exercise: Import the Actigraph data

```{r}
user_1_Actigraph_file <- 
    here("data-raw/mmash/user_1/Actigraph.csv")
user_1_Actigraph_data_prep <- vroom(
    user_1_Actigraph_file,
    col_select = -1,
    n_max = 100,
    .name_repair = snakecase::to_snake_case
)
spec(user_1_Actigraph_data_prep)

user_1_Actigraph_data <- vroom(
    user_1_Actigraph_file,
    col_select = -1,
    col_types = cols(
        axis_1 = col_double(),
        axis_2 = col_double(),
        axis_3 = col_double(),
        steps = col_double(),
        hr = col_double(),
        inclinometer_off = col_double(),
        inclinometer_standing = col_double(),
        inclinometer_sitting = col_double(),
        inclinometer_lying = col_double(),
        vector_magnitude = col_double(),
        day = col_double(),
        time = col_time(format = "")
    ),
    
    .name_repair = snakecase::to_snake_case #fix names so they are all snakecase
)
user_1_Actigraph_data_prep
```


## Making a function
```{r}
#' Add two numbers together.
#'
#' @param num1 A number here.
#' @param num2 A number here.
#'
#' @return Returns the sum of the two numbers

add_numbers <- function(num1, num2){
    added <- num1 + num2
    return(added)
}



import_user_info(here("data-raw/mmash/user_1/user_info.csv"))

import_user_info(here("data-raw/mmash/user_2/user_info.csv"))
```

## Exercise for importing the saliva data as a function

```{r}


import_saliva_data(here("data-raw/mmash/user_1/saliva.csv"))
```

##Exercise for importing the RR data as a function

```{r}


import_RR_data(here("data-raw/mmash/user_1/RR.csv"))
```

##Exercise import Actigraph data

```{r}


import_Actigraph_data(here("data-raw/mmash/user_1/Actigraph.csv"))
```

## For loop

```{r}
#Vector of values
values <- 1:10

#Manually
#sum <- values[1]+values[2].....

##For loop
total_sum <- 0 #the value you start with
for (value in values) {
    total_sum <- value + total_sum
    #print(total_sum) can be used to debug
}



```

## Functional programming

```{r}
#Create a vector of numbers
numbers <- 1:10

#Create function to check if a given number is above 5
#over_five <- function(number){
#    if(number > 5) {
#        return(TRUE)
#    } else {
#        return(FALSE)
#    }
#}

#Functional
#map(numbers, over_five) #you cannot have a function within a function

#Functional without the creating the function first but just the vector
map(numbers, ~if_else(.x > 5, TRUE, FALSE))

#Test function manually
#over_five(numbers[1])
#over_five(numbers[5])
#over_five(numbers[8])

#Create loop for very complex things
#output <- vector("logical", length(numbers)) #output is either true or false
#for (i in seq_along(numbers)) {
#    output[i] <- over_five(numbers[i])
#}
#output

```
##add packages to the description files
#usethis::use_package("")


## Using map

```{r}
#Get vector containing all paths
user_info_files <- dir_ls(here("data-raw/mmash"),
                            recurse = TRUE,
                            regexp = "user_info.csv")

# Use map to import user info files
user_info_list <- map(user_info_files, 
                      import_user_info)

#indexing into list
#user_info_list[[1]]

# Use map to import user info files into a data frame
user_info_df <- map_dfr(user_info_files, 
                        import_user_info, 
                        .id = "file_path_id")

user_info_df
```

## Import user info into a data frame for saliva

```{r}
#Get vector containing all paths
saliva_data_files <- dir_ls(here("data-raw/mmash"),
                            recurse = TRUE,
                            regexp = "saliva.csv")

# Use map to import user info files into a data frame
saliva_data_df <- map_dfr(saliva_data_files, 
                        import_saliva_data, 
                        .id = "file_path_id")

saliva_data_df

```

#import multiple data frames
```{r}

import_multiple_files("saliva.csv", import_saliva_data)
```

##Data management

```{r}
#user_info_df %>%
#    select(where(is.character)) #splitting data

#Use summarize function to calculate mean's
saliva_data_df %>%
    summarise(cortisol_mean = mean(cortisol_norm),
              melatonin_mean = mean(melatonin_norm))

```
## Using across to summarise our data columns

```{r}
saliva_data_df %>%
    summarise(across(c(cortisol_norm, melatonin_norm),
                     mean))

```

## Named lists
```{r}
#Create named list
list_test <- list(Mean = mean)

#Test name of list
names(list_test)
```

##Combine across with a named list, and tidyselect helpers

```{r}
saliva_data_df %>%
    summarise(across(where(is.numeric), 
                     list(Mean = mean, SD = sd)))
```

## Use the split-apply-combine methodology on the RR data

```{r}
#Import rr data into data frame 

rr_df <- import_multiple_files("RR.csv", import_RR_data)

# Split and summarise data
summarised_rr_df <- rr_df %>%
    group_by(day, file_path_id) %>%
    summarise(across(ibi_s,
                     list(Mean = mean,
                          SD = sd), na.rm = TRUE)) %>%
    ungroup()

summarised_rr_df
```

##Exercise: Summarise Actigraph

```{r}
#Import Actigraph data into data frame
Actigraph_df <- import_multiple_files("Actigraph.csv", import_Actigraph_data)

# Split and summarise data
summarised_Actigraph_df <- Actigraph_df %>%
    group_by(file_path_id, day, steps) %>%
    summarise(across(hr,
                     list(Mean = mean,
                          SD = sd), na.rm = TRUE)) %>%
    ungroup()

summarised_Actigraph_df
```

